{"version":3,"file":"861.bundle.js","mappings":"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","sources":["webpack://gpx-viewer/./node_modules/@raruto/leaflet-elevation/src/components/d3.js","webpack://gpx-viewer/./node_modules/@raruto/leaflet-elevation/src/components/chart.js"],"sourcesContent":["export const Area = ({\n\twidth,\n\theight,\n\txAttr,\n\tyAttr,\n\tscaleX,\n\tscaleY,\n\tinterpolation = \"curveLinear\"\n}) => {\n\treturn d3.area()\n\t\t.curve(typeof interpolation === 'string' ? d3[interpolation] : interpolation)\n\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\n\t\t.y0(height)\n\t\t.y1(d => scaleY(d[yAttr]));\n};\n\nexport const Path = ({\n\tname,\n\tcolor,\n\tstrokeColor,\n\tstrokeOpacity,\n\tfillOpacity,\n\tclassName = ''\n}) => {\n\tlet path = d3.create('svg:path')\n\n\tif (name) path.classed(name + ' ' + className, true);\n\n\tpath.style(\"pointer-events\", \"none\");\n\n\tpath\n\t.attr(\"fill\", color || '#3366CC')\n\t.attr(\"stroke\", strokeColor || '#000')\n\t.attr(\"stroke-opacity\", strokeOpacity || '1')\n\t.attr(\"fill-opacity\", fillOpacity || '0.8');\n\n\treturn path;\n};\n\nexport const Axis = ({\n\ttype = \"axis\",\n\ttickSize = 6,\n\ttickPadding = 3,\n\tposition,\n\theight,\n\twidth,\n\taxis,\n\tscale,\n\tticks,\n\ttickFormat,\n\tlabel,\n\tlabelX,\n\tlabelY,\n\tname = \"\",\n\tonAxisMount,\n}) => {\n\treturn g => {\n\t\tlet [w, h] = [0, 0];\n\t\tif (position == \"bottom\") h = height;\n\t\tif (position == \"right\")  w = width;\n\n\t\tif (axis == \"x\" && type == \"grid\") {\n\t\t\ttickSize = -height;\n\t\t} else if (axis == \"y\" && type == \"grid\") {\n\t\t\ttickSize = -width;\n\t\t}\n\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\n\t\t\t.scale(scale)\n\t\t\t.ticks(typeof ticks === 'function' ? ticks() : ticks)\n\t\t\t.tickPadding(tickPadding)\n\t\t\t.tickSize(tickSize)\n\t\t\t.tickFormat(tickFormat);\n\n\t\tlet axisGroup = g.append(\"g\")\n\t\t\t.attr(\"class\", [axis, type, position, name].join(\" \"))\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\n\t\t\t.call(axisScale);\n\n\t\tif (label) {\n\t\t\taxisGroup.append(\"svg:text\")\n\t\t\t\t.attr(\"x\", labelX)\n\t\t\t\t.attr(\"y\", labelY)\n\t\t\t\t.text(label);\n\t\t}\n\n\t\tif (onAxisMount) {\n\t\t\taxisGroup.call(onAxisMount);\n\t\t}\n\n\t\treturn axisGroup;\n\t};\n};\n\nexport const Grid = (props) => {\n\tprops.type = \"grid\";\n\treturn Axis(props);\n};\n\nexport const PositionMarker = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n\tlabels = {},\n\titem = {},\n\tlength = 0,\n}) => {\n\treturn g => {\n\n\t\tg.attr(\"class\", \"height-focus-group\");\n\n\t\tlet line   = g.select('.height-focus.line');\n\t\tlet circle = g.select('.height-focus.circle-lower');\n\t\tlet text   = g.select('.height-focus-label');\n\n\t\tif (!line.node()) line = g.append('svg:line');\n\t\tif (!circle.node()) circle = g.append('svg:circle');\n\t\tif (!text.node()) text = g.append('svg:text');\n\n\t\tif (isNaN(xCoord) || isNaN(yCoord)) return g;\n\n\t\tcircle\n\t\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\n\t\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\n\t\t\t.attr(\"r\", 6)\n\t\t\t.attr(\"cx\", 0)\n\t\t\t.attr(\"cy\", 0);\n\n\t\tline\n\t\t\t.attr(\"class\", theme + \" height-focus line\")\n\t\t\t.attr(\"x1\", xCoord)\n\t\t\t.attr(\"x2\", xCoord)\n\t\t\t.attr(\"y1\", yCoord)\n\t\t\t.attr(\"y2\", length);\n\n\t\ttext\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\n\t\t\t.style(\"pointer-events\", \"none\")\n\t\t\t.attr(\"x\", xCoord + 5)\n\t\t\t.attr(\"y\", length);\n\n\t\tlet label;\n\n\t\tObject\n\t\t\t.keys(labels)\n\t\t\t.sort((a, b) => labels[a].order - labels[b].order) // TODO: any performance issues?\n\t\t\t.forEach((i)=> {\n\t\t\t\tlabel = text.select(\".height-focus-\" + labels[i].name);\n\n\t\t\t\tif (!label.size()) {\n\t\t\t\t\tlabel = text.append(\"svg:tspan\")\n\t\t\t\t\t\t.attr(\"class\", \"height-focus-\" + labels[i].name /*+ \" \" + \"order-\" + labels[i].order*/)\n\t\t\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t\t\t}\n\n\t\t\t\tlabel.text(typeof labels[i].value !== \"function\" ? labels[i].value : labels[i].value(item));\n\n\t\t\t});\n\n\t\ttext.select('tspan').attr(\"dy\", text.selectAll('tspan').size() > 1 ? \"-1.5em\" : \"0em\" );\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\n\n\t\treturn g;\n\t}\n};\n\nexport const LegendItem = ({\n\tname,\n\tlabel,\n\twidth,\n\theight,\n\tmargins = {},\n\tcolor,\n\tpath,\n\tclassName = ''\n}) => {\n\treturn g => {\n\t\tg\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\n\t\t\t.attr(\"data-name\", name);\n\n\t\tg.on('click.legend', () => d3.select(g.node().ownerSVGElement || g)\n\t\t\t.dispatch(\"legend_clicked\", {\n\t\t\t\tdetail: {\n\t\t\t\t\tpath: path.node(),\n\t\t\t\t\tname: name,\n\t\t\t\t\tlegend: g.node(),\n\t\t\t\t\tenabled: !path.classed('leaflet-hidden'),\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tg.append(\"svg:rect\")\n\t\t\t.attr(\"x\", (width / 2) - 50)\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\n\t\t\t.attr(\"width\", 50)\n\t\t\t.attr(\"height\", 10)\n\t\t\t.attr(\"fill\", color)\n\t\t\t.attr(\"stroke\", \"#000\")\n\t\t\t.attr(\"stroke-opacity\", \"0.5\")\n\t\t\t.attr(\"fill-opacity\", \"0.25\")\n\t\t\t.attr(\"class\", className);\n\n\t\tg.append('svg:text')\n\t\t\t.text(L._(label || name))\n\t\t\t.attr(\"x\", (width / 2) + 5)\n\t\t\t.attr(\"font-size\", 10)\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr('y', height + margins.bottom / 2)\n\t\t\t.attr('dy', \"0.75em\");\n\n\t\treturn g;\n\t}\n};\n\nexport const LegendSmall = ({\n\twidth,\n\theight,\n\titems,\n\tonClick\n}) => {\n\treturn g => {\n\t\tlet idx = 0;\n\n\t\tg.data([{\n\t\t\tx: width,\n\t\t\ty: height + 40\n\t\t}]).attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\").classed('legend-switcher');\n\n\t\t// let label  = g.selectAll(\".legend-switcher-label\")  .data([{ idx: 0 }]);\n\t\tlet label = g.append('svg:text')\n\t\t\t\t\t\t.attr(\"class\", \"legend-switcher-label\")\n\t\t\t\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t\t\t\t.attr(\"x\", -25)\n\t\t\t\t\t\t.attr(\"y\", 5)\n\t\t\t\t\t\t.on(\"mousedown\", (e, d) => setIdx(L.Util.wrapNum((idx + 1), [0, items.length])));\n\n\t\tlet symbol = g.selectAll(\".legend-switcher-symbol\").data([\n\t\t\t{ type: d3.symbolTriangle, x: 0,   y: 3, angle: 0,   size: 50, id: \"down\" },\n\t\t\t{ type: d3.symbolTriangle, x: -13, y: 0, angle: 180, size: 50, id: \"up\" }\n\t\t]);\n\n\t\tsymbol.exit().remove();\n\t\tlabel.exit().remove();\n\t\n\t\tsymbol.enter()\n\t\t\t.append(\"svg:path\")\n\t\t\t.attr(\"class\", \"legend-switcher-symbol\")\n\t\t\t.attr(\"cursor\", 'pointer')\n\t\t\t.attr(\"fill\", \"#000\")\n\t\t\t.merge(symbol)\n\t\t\t.attr(\"d\", \n\t\t\t\td3.symbol()\n\t\t\t\t.type(d => d.type)\n\t\t\t\t.size(d => d.size)\n\t\t\t)\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \") rotate(\" + d.angle + \")\")\n\t\t\t.on(\"mousedown\", (e, d) => setIdx(L.Util.wrapNum((d.id === \"up\" ? idx + 1 : idx - 1), [0, items.length])));\n\n\t\tconst setIdx = (id) => {\n\t\t\tidx = id;\n\t\t\t// label.enter()\n\t\t\t// \t.append('text')\n\t\t\t// \t.attr(\"class\", \"legend-switcher-label\")\n\t\t\t// \t.attr(\"text-anchor\", \"end\")\n\t\t\t// \t.attr(\"x\", -25)\n\t\t\t// \t.attr(\"y\", 5)\n\t\t\t// \t.merge(label.data([{ idx: id }]))\n\t\t\t// \t.text(d => items.length ? (items[idx][0].toUpperCase() + items[idx].slice(1)) : '')\n\t\t\t// \t.on(\"mousedown\", (e, d) => setIdx(L.Util.wrapNum((idx + 1), [0, items.length])));\n\t\t\tlabel.text(items.length ? L._((items[idx][0].toUpperCase() + items[idx].slice(1))) : '');\n\t\t\tonClick(items[idx]);\n\t\t};\n\t\tsetIdx(0);\n\t\t\n\t\treturn g;\n\t};\n};\n\nexport const Tooltip = ({\n\txCoord,\n\tyCoord,\n\twidth,\n\theight,\n\tlabels = {},\n\titem = {},\n}) => {\n\treturn g => {\n\n\t\tlet line = g.select('.mouse-focus-line');\n\t\tlet box = g.select('.mouse-focus-label');\n\n\t\tif (!line.node()) line = g.append('svg:line');\n\t\tif (!box.node()) box = g.append(\"g\");\n\n\t\tlet rect = box.select(\".mouse-focus-label-rect\");\n\t\tlet text = box.select(\".mouse-focus-label-text\");\n\n\t\tif (!rect.node()) rect = box.append(\"svg:rect\");\n\t\tif (!text.node()) text = box.append(\"svg:text\");\n\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\n\t\tlet xAlign = 0;\n\t\tlet yAlign = 0;\n\t\tlet bbox   = { width: 0, height: 0 };\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\n\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\n\n\t\tline\n\t\t\t.attr('class', 'mouse-focus-line')\n\t\t\t.attr('x2', xCoord)\n\t\t\t.attr('y2', 0)\n\t\t\t.attr('x1', xCoord)\n\t\t\t.attr('y1', height);\n\n\t\tbox\n\t\t\t.attr('class', 'mouse-focus-label');\n\n\t\trect\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\n\t\t\t.attr(\"x\", xAlign - 5)\n\t\t\t.attr(\"y\", yAlign - 5)\n\t\t\t.attr(\"width\", bbox.width + 10)\n\t\t\t.attr(\"height\", bbox.height + 10)\n\t\t\t.attr(\"rx\", 3)\n\t\t\t.attr(\"ry\", 3);\n\n\t\ttext\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr(\"y\", yAlign);\n\n\t\tlet label;\n\n\t\tObject\n\t\t\t.keys(labels)\n\t\t\t.sort((a, b) => labels[a].order - labels[b].order) // TODO: any performance issues?\n\t\t\t.forEach((i)=> {\n\t\t\t\tlabel = text.select(\".mouse-focus-label-\" + labels[i].name);\n\n\t\t\t\tif (!label.size()) {\n\t\t\t\t\tlabel = text.append(\"svg:tspan\", \".mouse-focus-label-x\")\n\t\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-\" + labels[i].name /*+ \" \" + \"order-\" + labels[i].order*/)\n\t\t\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t\t\t}\n\n\t\t\t\tlabel.text(typeof labels[i].value !== \"function\" ? labels[i].value : labels[i].value(item));\n\t\t\t});\n\n\t\ttext.select('tspan').attr(\"dy\", \"1em\");\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\n\n\t\treturn g;\n\t};\n};\n\nexport const Ruler = ({\n\theight,\n\twidth,\n}) => {\n\treturn g => {\n\n\t\tg.data([{\n\t\t\t\tx: 0,\n\t\t\t\ty: height,\n\t\t\t}])\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\");\n\n\t\tlet rect   = g.selectAll('.horizontal-drag-rect').data([{ w: width }]);\n\t\tlet line   = g.selectAll('.horizontal-drag-line').data([{ w: width }]);\n\t\tlet label  = g.selectAll('.horizontal-drag-label').data([{ w: width - 8 }]);\n\t\tlet symbol = g.selectAll('.horizontal-drag-symbol')\n\t\t\t.data([{\n\t\t\t\ttype: d3.symbolTriangle,\n\t\t\t\tx: width + 7,\n\t\t\t\ty: 0,\n\t\t\t\tangle: -90,\n\t\t\t\tsize: 50\n\t\t\t}]);\n\n\t\trect.exit().remove();\n\t\tline.exit().remove();\n\t\tlabel.exit().remove();\n\t\tsymbol.exit().remove();\n\n\t\trect.enter()\n\t\t\t.append(\"svg:rect\")\n\t\t\t.attr(\"class\", \"horizontal-drag-rect\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", -8)\n\t\t\t.attr(\"height\", 8)\n\t\t\t.attr('fill', 'none')\n\t\t\t.attr('pointer-events', 'all')\n\t\t\t.merge(rect)\n\t\t\t.attr(\"width\", d => d.w);\n\n\t\tline.enter()\n\t\t\t.append(\"svg:line\")\n\t\t\t.attr(\"class\", \"horizontal-drag-line\")\n\t\t\t.attr(\"x1\", 0)\n\t\t\t.merge(line)\n\t\t\t.attr(\"x2\", d => d.w);\n\n\t\tlabel.enter()\n\t\t\t.append(\"svg:text\")\n\t\t\t.attr(\"class\", \"horizontal-drag-label\")\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.attr(\"y\", -8)\n\t\t\t.merge(label)\n\t\t\t.attr(\"x\", d => d.w)\n\n\t\tsymbol\n\t\t\t.enter()\n\t\t\t.append(\"svg:path\")\n\t\t\t.attr(\"class\", \"horizontal-drag-symbol\")\n\t\t\t.merge(symbol)\n\t\t\t.attr(\"d\",\n\t\t\t\td3.symbol()\n\t\t\t\t.type(d => d.type)\n\t\t\t\t.size(d => d.size)\n\t\t\t)\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \") rotate(\" + d.angle + \")\");\n\n\t\treturn g;\n\t}\n};\n\nexport const CheckPoint = ({\n\tpoint,\n\theight,\n\twidth,\n\tx,\n\ty\n}) => {\n\treturn g => {\n\n\t\tif (isNaN(x) || isNaN(y)) return g;\n\n\t\tif (!point.item || !point.item.property('isConnected')) {\n\t\t\tpoint.position = point.position || \"bottom\";\n\n\t\t\tpoint.item = g.append('g');\n\n\t\t\tpoint.item.append(\"svg:line\")\n\t\t\t\t.attr(\"y1\", 0)\n\t\t\t\t.attr(\"x1\", 0)\n\t\t\t\t.attr(\"style\",\"stroke: rgb(51, 51, 51); stroke-width: 0.5; stroke-dasharray: 2, 2;\");\n\n\t\t\tpoint.item\n\t\t\t\t.append(\"svg:circle\")\n\t\t\t\t.attr(\"class\", \" height-focus circle-lower\")\n\t\t\t\t.attr(\"r\", 3);\n\n\t\t\tif (point.label) {\n\t\t\t\tpoint.item.append(\"svg:text\")\n\t\t\t\t\t.attr(\"dx\", \"4px\")\n\t\t\t\t\t.attr(\"dy\", \"-4px\");\n\t\t\t}\n\t\t}\n\n\t\tpoint.item\n\t\t\t.datum({\n\t\t\t\tpos: point.position,\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t})\n\t\t\t.attr(\"class\", d => \"point \" + d.pos)\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\");\n\n\t\tpoint.item.select('line')\n\t\t\t.datum({\n\t\t\t\ty2: ({'top': -y, 'bottom': height - y})[point.position],\n\t\t\t\tx2: ({'left': -x, 'right': width - x})[point.position] || 0\n\t\t\t})\n\t\t\t.attr(\"y2\", d => d.y2)\n\t\t\t.attr(\"x2\", d => d.x2)\n\n\t\tif (point.label) {\n\t\t\tpoint.item.select('text')\n\t\t\t\t.text(point.label);\n\t\t}\n\n\t\treturn g;\n\t}\n};\n\nexport const Domain = ({\n\tmin,\n\tmax,\n\tattr,\n\tname,\n\tforceBounds,\n\tscale\n}) => function(data) {\n\tattr = (scale && scale.attr) || attr || name;\n\tlet domain = data && data.length ? d3.extent(data, d => d[attr]) : [0, 1];\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\n\t\tdomain[0] = min;\n\t}\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\n\t\tdomain[1] = max;\n\t}\n\treturn domain;\n};\n\nexport const Range = ({\n\taxis\n}) => function(width, height) {\n\tif (axis == 'x')      return [0, width];\n\telse if (axis == 'y') return [height, 0];\n};\n\nexport const Scale = ({\n\tdata,\n\tattr,\n\tmin,\n\tmax,\n\tforceBounds,\n\trange,\n}) => {\n\treturn d3.scaleLinear()\n\t\t.range(range)\n\t\t.domain(Domain({min, max, attr, forceBounds})(data));\n};\n\nexport const Bisect = ({\n\tdata = [0, 1],\n\tscale,\n\tx,\n\tattr\n}) => {\n\treturn d3\n\t\t.bisector(d => d[attr])\n\t\t.left(data, scale.invert(x));\n};\n\nexport const Chart = ({\n\twidth,\n\theight,\n\tmargins = {},\n\truler,\n}) => {\n\n\tconst w = width - margins.left - margins.right;\n\tconst h = height - margins.top - margins.bottom;\n\n\t// SVG Container\n\tconst svg   = d3.create(\"svg:svg\").attr(\"class\", \"background\");\n\n\tconst defs = svg.append(\"svg:defs\");\n\n\t// SVG Groups\n\tconst g     = svg.append(\"g\");\n\tconst panes = {\n\t\tgrid   : g.append(\"g\").attr(\"class\", \"grid\"),\n\t\tarea   : g.append('g').attr(\"class\", \"area\"),\n\t\taxis   : g.append('g').attr(\"class\", \"axis\"),\n\t\tpoint  : g.append('g').attr(\"class\", \"point\"),\n\t\tbrush  : g.append(\"g\").attr(\"class\", \"brush\"),\n\t\ttooltip: g.append(\"g\").attr(\"class\", \"tooltip\").attr('display', 'none'),\n\t\truler  : g.append('g').attr('class', 'ruler'),\n\t\tlegend : g.append('g').attr(\"class\", \"legend\"),\n\t};\n\n\t// SVG Paths\n\tconst mask          = panes.area   .append(\"svg:mask\")         .attr(\"id\", 'elevation-clipper-' + Math.random().toString(36).substr(2, 9)).attr('fill-opacity', 1);\n\tconst maskRect      = mask         .append(\"svg:rect\")         .attr('class', 'zoom')          .attr('fill', 'white'); // white = transparent\n\n\t// Canvas Paths\n\tconst foreignObject = panes.area   .append('svg:foreignObject').attr('mask', 'url(#' + mask.attr('id') + ')');\n\tconst canvas        = foreignObject.append('xhtml:canvas')     .attr('class', 'canvas-plot');\n\tconst context       = canvas.node().getContext('2d');\n\n\t// Add tooltip\n\tpanes.tooltip.call(Tooltip({ xCoord: 0, yCoord: 0, height: h, width : w, labels: {} }));\n\n\t// Add the brushing\n\tlet brush   = d3.brushX().on('start.cursor end.cursor brush.cursor', () => panes.brush.select(\".overlay\").attr('cursor', null));\n\n\t// Scales\n\tconst scale = (opts) => ({ x: Scale(opts.x), y: Scale(opts.y)});\n\n\tlet utils = {\n\t\tdefs,\n\t\tmask,\n\t\tcanvas,\n\t\tcontext,\n\t\tbrush,\n\t};\n\n\tlet chart = {\n\t\tsvg,\n\t\tg,\n\t\tpanes,\n\t\tutils,\n\t\tscale,\n\t};\n\n\t// Resize\n\tchart._resize  = ({\n\t\twidth,\n\t\theight,\n\t\tmargins = {},\n\t\truler,\n\t}) => {\n\n\t\tconst w = width - margins.left - margins.right;\n\t\tconst h = height - margins.top - margins.bottom;\n\n\t\tsvg          .attr(\"width\", width).attr(\"height\", height).attr(\"viewBox\", `0 0 ${width} ${height}`);\n\t\tg            .attr(\"transform\", \"translate(\" + margins.left + \",\" + margins.top + \")\");\n\n\t\t// Fix: https://github.com/Raruto/leaflet-elevation/issues/123\n\t\t// Fix: https://github.com/Raruto/leaflet-elevation/issues/232\n\t\tif (\n\t\t\t/Mac|iPod|iPhone|iPad/.test(navigator.platform) &&\n\t\t\t/AppleWebkit/i.test(navigator.userAgent) &&\n\t\t\t!/Chrome/.test(navigator.userAgent)\n\t\t) {\n\t\t\tcanvas   .style(\"transform\", \"translate(\" + margins.left + \"px,\" + margins.top + \"px)\");\n\t\t}\n\n\t\tmaskRect     .attr(\"width\", w).attr(\"height\", h).attr(\"x\", 0).attr(\"y\", 0);\n\t\tforeignObject.attr('width', w).attr('height', h);\n\t\tcanvas       .attr('width', w).attr('height', h);\n\n\t\tif (ruler) {\n\t\t\tpanes.ruler.call(Ruler({ height: h, width: w }));\n\t\t}\n\n\t\tpanes.brush.call(brush.extent( [ [0,0], [w, h] ] ));\n\t\tpanes.brush.select(\".overlay\").attr('cursor', null);\n\n\t\tchart._width  = w;\n\t\tchart._height = h;\n\n\t\tchart.svg.dispatch('resize', { detail: { width: w, height: h } } );\n\n\t};\n\n\tchart.pane = (name) => (panes[name] || (panes[name] = g.append('g').attr(\"class\", name)));\n\tchart.get  = (name) => utils[name];\n\n\tchart._resize({ width, height, margins});\n\n\treturn chart;\n};\n","import * as D3 from './d3.js';\n\nconst _ = L.Control.Elevation.Utils;\n\nexport var Chart = L.Control.Elevation.Chart = L.Class.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\tinitialize(opts, control) {\n\t\tthis.options       = opts;\n\t\tthis.control       = control;\n\n\t\tthis._data         = control._data || [];\n\n\t\t// cache registered components\n\t\tthis._props        = {\n\t\t\tscales      : {},\n\t\t\tpaths       : {},\n\t\t\tareas       : {},\n\t\t\tgrids       : {},\n\t\t\taxes        : {},\n\t\t\tlegendItems : {},\n\t\t\ttooltipItems: {},\n\t\t};\n\n\t\tthis._scales       = {};\n\t\tthis._domains      = {};\n\t\tthis._ranges       = {};\n\t\tthis._paths        = {};\n\n\t\tthis._brushEnabled = opts.dragging;\n\t\tthis._zoomEnabled  = opts.zooming;\n\n\t\topts.xTicks = this._xTicks();\n\t\topts.yTicks = this._yTicks();\n\t\t\n\t\tlet chart       = this._chart = D3.Chart(opts);\n\n\t\t// SVG Container\n\t\tthis._container = chart.svg;\n\n\t\t// Panes\n\t\tthis._grid      = chart.pane('grid');\n\t\tthis._area      = chart.pane('area');\n\t\tthis._point     = chart.pane('point');\n\t\tthis._axis      = chart.pane('axis');\n\t\tthis._legend    = chart.pane('legend');\n\t\tthis._tooltip   = chart.pane('tooltip');\n\t\tthis._ruler     = chart.pane('ruler');\n\n\t\t// Scales\n\t\tthis._initScale();\n\n\t\t// Helpers\n\t\tthis._mask      = chart.get('mask');\n\t\tthis._context   = chart.get('context');\n\t\tthis._brush     = chart.get('brush');\n\n\t\tthis._zoom      = d3.zoom();\n\t\tthis._drag      = d3.drag();\n\n\t\t// Interactions\n\t\tthis._initInteractions();\n\n\t\t// svg.on('resize', (e)=>console.log(e.detail));\n\n\t\t// Handle multi-track segments\n\t\tthis._maskGaps = [];\n\t\tcontrol.on('eletrack_added', ({index}) => {\n\t\t\tthis._maskGaps.push(index);\n\t\t\tcontrol.once('elepoint_added', ({index}) => this._maskGaps.push(index));\n\t\t});\n\n\t},\n\n\tupdate(props) {\n\t\tif (props) {\n\t\t\tif (props.data) this._data = props.data;\n\t\t\tif (props.options) this.options = props.options;\n\t\t}\n\n\t\tthis.options.xTicks = this._xTicks();\n\t\tthis.options.yTicks = this._yTicks();\n\n\t\tthis._updateScale();\n\t\tthis._updateAxis();\n\t\tthis._updateMargins();\n\t\tthis._updateLegend();\n\t\tthis._updateClipper();\n\t\tthis._updateArea();\n\n\t\treturn this;\n\t},\n\n\trender() {\n\t\treturn container => container.append(() => this._container.node());\n\t},\n\n\tclear() {\n\t\tthis._resetDrag();\n\t\tthis._hideDiagramIndicator()\n\t\tthis._area.selectAll('path').attr(\"d\", \"M0 0\");\n\t\tthis._context.clearRect(0, 0, this._width(), this._height());\n\t\tthis._mask.selectAll(\".gap\").remove();\n\t\tthis._maskGaps = [];\n\n\t\t// if (this._path) {\n\t\t\t// this._x.domain([0, 1]);\n\t\t\t// this._y.domain([0, 1]);\n\t\t// }\n\t},\n\n\t_drawPath(name) {\n\t\tlet path   = this._paths[name];\n\t\tlet area   = this._props.areas[name];\n\n\t\tpath.datum(this._data).attr(\"d\",\n\t\t\tD3.Area(\n\t\t\t\tL.extend({}, area, {\n\t\t\t\t\twidth        : this._width(),\n\t\t\t\t\theight       : this._height(),\n\t\t\t\t\tscaleX       : this._scales[area.scaleX],\n\t\t\t\t\tscaleY       : this._scales[area.scaleY]\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\n\t\tif (!path.classed('leaflet-hidden')) {\n\t\t\tthis.options.preferCanvas\n\t\t\t\t? _.drawCanvas(this._context, path)\n\t\t\t\t: _.append(this._area.node(), path.node());\n\t\t}\n\t},\n\n\t_hasActiveLayers() {\n\t\tconst paths = this._paths;\n\t\tfor (var i in paths) {\n\t\t\tif (!paths[i].classed('leaflet-hidden')) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Initialize \"d3-brush\".\n\t */\n\t_initBrush(e) {\n\t\tconst brush   = ({selection}) => {\n\t\t\tif (selection && this._data.length) {\n\t\t\t\tlet start = this._findIndexForXCoord(selection[0]);\n\t\t\t\tlet end   = this._findIndexForXCoord(selection[1]);\n\t\t\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\n\t\t\t}\n\t\t}\n\n\t\tconst focus   = (e) => {\n\t\t\tif (this._data.length && (e.type != 'brush' /*|| e.sourceEvent*/)) {\n\t\t\t\tlet rect    = this._chart.panes.brush.select('.overlay').node();\n\t\t\t\tlet coords  = d3.pointers(e, rect)[0];\n\t\t\t\tlet xCoord  = coords[0];\n\t\t\t\tlet item    = this._data[this._findIndexForXCoord(xCoord)];\n\n\t\t\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\n\t\t\t}\n\t\t};\n\n\t\tthis._brush\n\t\t\t.filter(({shiftKey, button}) => !shiftKey && !button && this._brushEnabled)\n\t\t\t.on(\"end.update\", brush)\n\t\t\t.on(\"brush.update\", focus);\n\n\t\tthis._chart.panes.brush\n\t\t\t.on(\"mouseenter.focus touchstart.focus\", this.fire.bind(this, \"mouse_enter\"))\n\t\t\t.on(\"mouseout.focus touchend.focus\",     this.fire.bind(this, \"mouse_out\")  )\n\t\t\t.on(\"mousemove.focus touchmove.focus\",   focus                              );\n\n\t},\n\n\t/**\n\t * Initialize \"d3-zoom\"\n\t */\n\t_initClipper() {\n\t\tlet svg       = this._container;\n\t\tlet margin    = this.options.margins;\n\n\t\tconst zoom    = this._zoom;\n\n\t\tconst onStart = ({transform, sourceEvent}) => {\n\t\t\tif (sourceEvent && sourceEvent.type == \"mousedown\") svg.style('cursor', 'grabbing');\n\t\t\tif (transform.k == 1 && transform.x == 0) {\n\t\t\t\tthis._container.classed('zoomed', true);\n\t\t\t\t// Apply d3-zoom and bind <mask>\n\t\t\t\tif (this._mask) {\n\t\t\t\t\tthis._point.attr('mask', 'url(#' + this._mask.attr('id') + ')');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.zooming = true;\n\t\t};\n\n\t\tconst onEnd  = ({transform}) => {\n\t\t\tif (transform.k ==1 && transform.x == 0) {\n\t\t\t\tthis._container.classed('zoomed', false);\n\t\t\t\t// Reset d3-zoom and remove <mask>\n\t\t\t\tif (this._mask) {\n\t\t\t\t\tthis._point.attr('mask', null);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.zooming = false;\n\t\t\tsvg.style('cursor', '');\n\t\t};\n\n\t\tconst onZoom = ({transform, sourceEvent}) => {\n\t\t\t// TODO: find a faster way to redraw the chart.\n\t\t\tthis.zooming = false;\n\t\t\tthis._updateScale(); // hacky way for restoring x scale when zooming out\n\t\t\tthis.zooming = true;\n\t\t\tthis._scales.distance = this._x = transform.rescaleX(this._x); // calculate x scale at zoom level\n\t\t\tif (this._scales.time) this._scales.time = transform.rescaleX(this._scales.time); // calculate x scale at zoom level\n\t\t\tthis._resetDrag();\n\t\t\tif (sourceEvent && sourceEvent.type == \"mousemove\") {\n\t\t\t\tthis._hideDiagramIndicator();\n\t\t\t}\n\t\t\tthis.fire('zoom');\n\t\t};\n\n\t\tzoom\n\t\t\t.scaleExtent([1, 10])\n\t\t\t.extent([\n\t\t\t\t[margin.left, 0],\n\t\t\t\t[this._width() - margin.right, this._height()]\n\t\t\t])\n\t\t\t.translateExtent([\n\t\t\t\t[margin.left, -Infinity],\n\t\t\t\t[this._width() - margin.right, Infinity]\n\t\t\t])\n\t\t\t.filter(({shiftKey, buttons}) => (shiftKey || buttons == 4) && this._zoomEnabled)\n\t\t\t.on(\"start\", onStart)\n\t\t\t.on(\"end\", onEnd)\n\t\t\t.on(\"zoom\", onZoom);\n\n\t\tsvg.call(zoom); // add zoom functionality to \"svg\" group\n\n\t\t// d3.select(\"body\").on(\"keydown.grabzoom keyup.grabzoom\", (e) => svg.style('cursor', e.shiftKey ? 'move' : ''));\n\n\t},\n\n\t_initInteractions() {\n\t\tthis._initBrush();\n\t\tthis._initRuler();\n\t\tthis._initClipper();\n\t\tthis._initLegend();\n\t},\n\n\t/**\n\t * Toggle chart data on legend click\n\t */\n\t_initLegend() {\n\t\tthis._container.on('legend_clicked', ({detail}) => {\n\t\t\tlet { path, legend, name, enabled } = detail;\n\t\t\tif (path) {\n\t\t\t\tlet label = _.select('text', legend);\n\t\t\t\tlet rect  = _.select('rect', legend);\n\t\t\t\t_.toggleStyle(label, 'text-decoration-line', 'line-through', enabled);\n\t\t\t\t_.toggleStyle(rect,  'fill-opacity',         '0',            enabled);\n\t\t\t\t_.toggleClass(path,  'leaflet-hidden',                       enabled);\n\t\t\t\tthis._updateArea();\n\t\t\t\tthis.fire(\"elepath_toggle\", { path, name, legend, enabled })\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Initialize \"ruler\".\n\t */\n\t_initRuler() {\n\t\tif (!this.options.ruler) return;\n\n\t\t// const yMax      = this._height();\n\t\tconst formatNum = d3.format(\".0f\");\n\t\tconst drag      = this._drag;\n\n\t\tconst label     = (e, d) => {\n\t\t\tlet yMax      = this._height();\n\t\t\tlet y         = this._ruler.data()[0].y;\n\t\t\tif (y >= yMax || y <= 0) this._ruler.select(\".horizontal-drag-label\").text('');\n\t\t\tthis._hideDiagramIndicator();\n\t\t};\n\n\t\tconst position  = (e, d) => {\n\t\t\tlet yCoord    = d3.pointers(e, this._area.node())[0][1];\n\t\t\tlet yMax      = this._height();\n\t\t\tlet y         = _.clamp(yCoord, [0, yMax]);\n\n\t\t\tthis._ruler\n\t\t\t\t.data([L.extend(this._ruler.data()[0], { y: y })])\n\t\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\")\n\t\t\t\t.classed('active', y < yMax);\n\n\t\t\tthis._container\n\t\t\t\t.select(\".horizontal-drag-label\")\n\t\t\t\t.text(formatNum(this._y.invert(y)) + \" \" + (this.options.imperial ? 'ft' : 'm'));\n\n\t\t\tthis.fire('ruler_filter', { coords: yCoord < yMax && yCoord > 0 ? this._findCoordsForY(yCoord) : [] });\n\t\t}\n\n\t\tdrag\n\t\t\t.on(\"start end\", label)\n\t\t\t.on(\"drag\", position);\n\n\t\tthis._ruler.call(drag);\n\n\t},\n\n\t/**\n\t * Initialize x and y scales\n\t */\n\t_initScale() {\n\t\tlet opts = this.options;\n\n\t\tthis._registerAxisScale({\n\t\t\taxis    : 'x',\n\t\t\tposition: 'bottom',\n\t\t\tattr    : opts.xAttr,\n\t\t\tmin     : opts.xAxisMin,\n\t\t\tmax     : opts.xAxisMax,\n\t\t\tname    : 'distance'\n\t\t});\n\n\t\tthis._registerAxisScale({\n\t\t\taxis     : 'y',\n\t\t\tposition : 'left',\n\t\t\tattr     : opts.yAttr,\n\t\t\tmin      : opts.yAxisMin,\n\t\t\tmax      : opts.yAxisMax,\n\t\t\tname     : 'altitude'\n\t\t});\n\n\t\tthis._x = this._scales.distance;\n\t\tthis._y = this._scales.altitude;\n\t},\n\n\t_registerAreaPath(props) {\n\t\tif (props.scale == 'y') props.scale = this._y;\n\t\telse if (props.scale == 'x') props.scale = this._x;\n\n\t\tlet opts = this.options;\n\n\t\tif (!props.xAttr) props.xAttr = opts.xAttr;\n\t\tif (!props.yAttr) props.yAttr = opts.yAttr;\n\t\tif (typeof props.preferCanvas === \"undefined\") props.preferCanvas = opts.preferCanvas;\n\n\t\t// Save paths in memory for latter usage\n\t\tthis._paths[props.name]       = D3.Path(props);\n\t\tthis._props.areas[props.name] = props;\n\n\t\tif (opts.legend) {\n\t\t\tthis._props.legendItems[props.name] = {\n\t\t\t\tname     : props.name,\n\t\t\t\tlabel    : props.label,\n\t\t\t\tcolor    : props.color,\n\t\t\t\tclassName: props.className,\n\t\t\t\tpath     : this._paths[props.name]\n\t\t\t};\n\t\t}\n\n\t},\n\n\t_registerAxisGrid(props) {\n\t\tif (props.scale == 'y') props.scale = this._y;\n\t\telse if (props.scale == 'x') props.scale = this._x;\n\n\t\tthis._props.grids[props.name || props.axis] = props;\n\t},\n\n\t_registerAxisScale(props) {\n\t\tif (props.scale == 'y') props.scale = this._y;\n\t\telse if (props.scale == 'x') props.scale = this._x;\n\n\t\tlet opts  = this.options;\n\t\tlet scale = props.scale;\n\n\t\tif (typeof this._scales[props.name] === 'function') {\n\t\t\tprops.scale = this._scales[props.name]; // retrieve cached scale\n\t\t} else if (typeof scale !== 'function') {\n\t\t\tscale       = L.extend({\n\t\t\t\tdata       : this._data,\n\t\t\t\tforceBounds: opts.forceAxisBounds\n\t\t\t}, scale);\n\n\t\t\tscale.attr   = scale.attr || props.name;\n\n\t\t\tlet domain   = this._domains[props.name] = D3.Domain(props);\n\t\t\tlet range    = this._ranges[props.name]  = D3.Range(props);\n\t\t\tscale.range  = scale.range  || range(this._width(),this._height());\n\t\t\tscale.domain = scale.domain || domain(this._data);\n\n\t\t\tthis._props.scales[props.name] = scale;\n\n\t\t\tprops.scale = this._scales[props.name] = D3.Scale(scale);\n\t\t}\n\n\t\tif (!props.ticks) {\n\t\t\tif (props.axis == 'x')      props.ticks = this._xTicks.bind(this);\n\t\t\telse if (props.axis == 'y') props.ticks = this._yTicks.bind(this);\n\t\t}\n\n\t\tthis._props.axes[props.name] = props;\n\n\t\tif (props.name == this.options.yScale) this._y = scale;\n\t\tif (props.name == this.options.xScale) this._x = scale;\n\n\t\treturn scale;\n\t},\n\n\t/**\n\t * Add a point of interest over the chart\n\t */\n\t_registerCheckPoint(point) {\n\t\tif (!this._data.length) return;\n\n\t\tconst {xAttr, yAttr} = this.options;\n\t\tlet item, x, y;\n\n\t\tif (point.latlng) {\n\t\t\titem = this._data[this._findIndexForLatLng(point.latlng)];\n\t\t\tx    = this._x(item[xAttr]);\n\t\t\ty    = this._y(item[yAttr]);\n\t\t} else if (!isNaN(point[xAttr])) {\n\t\t\tx    = this._x(point[xAttr]);\n\t\t\titem = this._data[this._findIndexForXCoord(x)]\n\t\t\ty    = this._y(item[yAttr]);\n\t\t} \n\n\t\tthis._point.call(D3.CheckPoint({\n\t\t\tpoint: point,\n\t\t\twidth: this._width(),\n\t\t\theight: this._height(),\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t}));\n\t},\n\n\t_registerTooltip(props) {\n\t\tprops.order = props.order ?? 1000;\n\t\tthis._props.tooltipItems[props.name] = props;\n\t},\n\n\t_updateArea() {\n\t\t// Reset and update chart profiles\n\t\tthis._context.clearRect(0, 0, this._width(), this._height());\n\t\t_.each(this._paths, (path, i) => !path.classed('leaflet-hidden') && this._drawPath(i));\n\t},\n\n\t_updateAxis() {\n\n\t\tlet opts = this.options;\n\n\t\tconst gridOpts = {\n\t\t\twidth     : this._width(),\n\t\t\theight    : this._height(),\n\t\t\ttickFormat: \"\",\n\t\t};\n\n\t\tconst axesOpts  = {\n\t\t\twidth  : this._width(),\n\t\t\theight : this._height(),\n\t\t};\n\n\t\t// Reset grids\n\t\tthis._grid.selectAll('g').remove();\n\t\t_.each(this._props.grids, (grid, i) => {\n\t\t\tif (opts[i] !== false && opts[i] !== 'summary') {\n\t\t\t\tthis._grid.call(D3.Grid(L.extend({}, gridOpts, grid)))\n\t\t\t}\n\t\t});\n\n\t\t// Rest axis\n\t\tthis._axis.selectAll('g').remove();\n\t\t_.each(this._props.axes,  (axis, i) => {\n\t\t\tif (opts[i] !== false && opts[i] !== 'summary') {\n\t\t\t\tthis._axis.call(D3.Axis(L.extend({}, axesOpts, axis)));\n\t\t\t}\n\t\t});\n\n\t\t// Adjust axis scale positions\n\t\tthis._axis\n\t\t\t.selectAll('.y.axis.right')\n\t\t\t.each((d, i, n) => {\n\n\t\t\t\tlet axis      = d3.select(n[i]);\n\t\t\t\tlet transform = axis.attr('transform');\n\t\t\t\tlet translate = transform.substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\")).split(\",\");\n\n\t\t\t\taxis.attr('transform', 'translate(' + (+translate[0] + (i * 40)) + ',' + translate[1] + ')')\n\n\t\t\t\tif (i > 0) {\n\t\t\t\t\taxis.select(':scope > path')         .attr('opacity', 0.25);\n\t\t\t\t\taxis.selectAll(':scope > .tick line').attr('opacity', 0.75);\n\t\t\t\t}\n\n\t\t\t});\n\n\t},\n\n\t_updateClipper() {\n\t\tconst { xAttr, margins } = this.options;\n\t\tconst data = this._data;\n\n\t\tthis._zoom\n\t\t\t.scaleExtent([1, 10])\n\t\t\t.extent([\n\t\t\t\t[margins.left, 0],\n\t\t\t\t[this._width() - margins.right, this._height()]\n\t\t\t])\n\t\t\t.translateExtent([\n\t\t\t\t[margins.left, -Infinity],\n\t\t\t\t[this._width() - margins.right, Infinity]\n\t\t\t]);\n\n\t\t// Apply svg mask on multi-track segments\n\t\tthis._mask.selectAll(\".gap\").remove()\n\t\tthis._maskGaps.forEach((d, i) => {\n\t\t\tif (i >= this._maskGaps.length - 2) return;\n\t\t\tlet x1 = this._x(data[this._findIndexForLatLng(data[this._maskGaps[i]].latlng)][xAttr]);\n\t\t\tlet x2 = this._x(data[this._findIndexForLatLng(data[this._maskGaps[i + 1]].latlng)][xAttr]);\n\t\t\tthis._mask\n\t\t\t\t.append(\"rect\")\n\t\t\t\t.attr(\"x\", x1)\n\t\t\t\t.attr(\"y\", 0)\n\t\t\t\t.attr(\"width\", x2 - x1 )\n\t\t\t\t.attr(\"height\", this._height())\n\t\t\t\t.attr('class', 'gap')\n\t\t\t\t.attr('fill-opacity', '0.8')\n\t\t\t\t.attr(\"fill\", 'black');  // hide = black (mask)\n\t\t});\n\t},\n\n\t_updateLegend: function () {\n\t\tlet xAxesB  = this._axis.selectAll('.x.axis.bottom').nodes().length;\n\t\t\n\t\t// Get legend items\n\t\tlet items = Object.keys(this._paths);\n\n\t\t// Calculate legend item positions\n\t\tlet n      = items.length;\n\t\tlet v      = Array(Math.floor(n / 2)).fill(null).map((d, i) => (i + 1) * 2 - (1 - Math.sign(n % 2)));\n\t\tlet rev    = v.slice().reverse().map((d) => -(d));\n\n\t\t// push a fake element to handle center alignment (odd numbers)\n\t\tif (n % 2 !== 0) {\n\t\t\trev.push(0);\n\t\t}\n\t\tv = rev.concat(v);\n\n\t\t// Reset legend items\n\t\tthis._legend.selectAll('g').remove();\n\n\t\t// Render legend items\n\t\t_.each(this._props.legendItems, (legend) => {\n\t\t\tthis._legend.append(\"g\").call(\n\t\t\t\tD3.LegendItem(L.extend({\n\t\t\t\t\twidth  : this._width(),\n\t\t\t\t\theight : this._height(),\n\t\t\t\t\tmargins: this.options.margins,\n\t\t\t\t}, legend))\n\t\t\t);\n\t\t});\n\n\t\t// Render legend item switcher\n\t\tif (n > 1) {\n\t\t\tthis._legend.append(\"g\").call(\n\t\t\t\tD3.LegendSmall({\n\t\t\t\t\twidth  : this._width(),\n\t\t\t\t\theight : this._height(),\n\t\t\t\t\titems  : items,\n\t\t\t\t\tonClick: (selected) => {\n\t\t\t\t\t\t_.each(items, name => this._togglePath(name, selected == name, true));\n\t\t\t\t\t\tthis._updateArea();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\t\n\t\t_.each(items, (name, i) => {\n\t\t\t// Adjust legend item positions\n\t\t\tthis._legend.select('[data-name=' + name + ']').attr(\"transform\", \"translate(\" + (v[i] * 55) + \", \" + (xAxesB * 2) + \")\");\n\t\t\t// Set initial state (disabled controls)\n\t\t\tthis._togglePath(name, !(name in this.options && this.options[name] == 'disabled'), true);\n\t\t});\n\n\t},\n\n\t_updateMargins() {\n\t\t// Get chart margins\n\t\tlet xAxesB  = this._axis.selectAll('.x.axis.bottom').nodes().length;\n\t\tlet xAxesL  = this._axis.selectAll('.y.axis.left').nodes().length;\n\t\tlet xAxesR  = this._axis.selectAll('.y.axis.right').nodes().length;\n\t\tlet marginB = 60 + (xAxesB * 2);\n\t\tlet marginL = 10 + (xAxesL * 30);\n\t\tlet marginR = 40 + (xAxesR * 30);\n\n\t\tlet marginsUpdated = false\n\n\t\t// Adjust right margin\n\t\tif (xAxesR && this.options.margins.right < marginR) {\n\t\t\tthis.options.margins.right  = marginR;\n\t\t\tmarginsUpdated = true;\n\t\t}\n\n\t\t// Adjust left margin\n\t\tif (xAxesL && this.options.margins.left < marginL) {\n\t\t\tthis.options.margins.left = marginL;\n\t\t\tmarginsUpdated = true;\n\t\t}\n\n\t\t// Adjust bottom margin\n\t\tif (xAxesB && this.options.margins.bottom < marginB) {\n\t\t\tthis.options.margins.bottom = marginB;\n\t\t\tmarginsUpdated = true;\n\t\t}\n\n\t\tif (marginsUpdated) {\n\t\t\tthis.fire('margins_updated');\n\t\t}\n\t},\n\n\t_updateScale() {\n\t\tif (this.zooming) return { x: this._x, y: this._y };\n\n\t\tfor (let i in this._scales) {\n\t\t\tthis._scales[i]\n\t\t\t\t.domain(this._domains[i](this._data))\n\t\t\t\t.range(this._ranges[i](this._width(), this._height()))\n\t\t}\n\n\t\treturn { x: this._x, y: this._y };\n\t},\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width() {\n\t\tif (this._chart) this._chart._width;\n\t\tconst { width, margins } = this.options;\n\t\treturn width - margins.left - margins.right;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height() {\n\t\tif (this._chart) return this._chart._height;\n\t\tconst { height, margins } = this.options;\n\t\treturn height - margins.top - margins.bottom;\n\t},\n\n\t/*\n\t * Finds data entries above a given y-elevation value and returns geo-coordinates\n\t */\n\t_findCoordsForY(y) {\n\t\tlet data = this._data;\n\t\tlet z    = this._y.invert(y);\n\n\t\t// save indexes of elevation values above the horizontal line\n\t\tconst list = data.reduce((array, item, index) => {\n\t\t\tif (item[this.options.yAttr] >= z) array.push(index);\n\t\t\treturn array;\n\t\t}, []);\n\n\t\tlet start = 0;\n\t\tlet next;\n\n\t\t// split index list into blocks of coordinates\n\t\tconst coords = list.reduce((array, _, curr) => {\n\t\t\tnext = curr + 1;\n\t\t\tif (list[next] !== list[curr] + 1 || next === list.length) {\n\t\t\t\tarray.push(\n\t\t\t\t\tlist\n\t\t\t\t\t.slice(start, next)\n\t\t\t\t\t.map(i => data[i].latlng)\n\t\t\t\t);\n\t\t\t\tstart = next;\n\t\t\t}\n\t\t\treturn array;\n\t\t}, []);\n\n\t\treturn coords;\n\t},\n\n\t/*\n\t * Finds a data entry for a given x-coordinate of the diagram\n\t */\n\t_findIndexForXCoord(x) {\n\t\treturn d3\n\t\t\t.bisector(d => d[this.options.xAttr])\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\n\t},\n\n\t/*\n\t * Finds a data entry for a given latlng of the map\n\t */\n\t_findIndexForLatLng(latlng) {\n\t\tlet result = null;\n\t\tlet d      = Infinity;\n\t\tthis._data.forEach((item, index) => {\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\n\t\t\tif (dist < d) {\n\t\t\t\td = dist;\n\t\t\t\tresult = index;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag() {\n\t\tif (this._chart.panes.brush.select(\".selection\").attr('width')) {\n\t\t\tthis._chart.panes.brush.call(this._brush.clear);\n\t\t\tthis._hideDiagramIndicator();\n\t\t\tthis.fire('reset_drag');\n\t\t}\n\t},\n\n\t_resetZoom() {\n\t\tif (this._zoom) {\n\t\t\tthis._zoom.transform(this._chart.svg, d3.zoomIdentity);\n\t\t}\n\t},\n\n\t/**\n\t * Display distance and altitude level (\"focus-rect\").\n\t */\n\t_showDiagramIndicator(item, xCoordinate) {\n\t\tthis._tooltip\n\t\t\t.attr(\"display\", null)\n\t\t\t.call(D3.Tooltip({\n\t\t\t\txCoord: xCoordinate,\n\t\t\t\tyCoord: this._y(item[this.options.yAttr]),\n\t\t\t\theight: this._height(),\n\t\t\t\twidth : this._width(),\n\t\t\t\tlabels: this._props.tooltipItems,\n\t\t\t\titem: item\n\t\t\t}));\n\t},\n\n\t_togglePath(name, enabled = true, lazy = false) {\n\t\tlet path    = this._paths[name];\n\t\tlet legend  = this._container.select('.legend [data-name=' + name + ']');\n\t\tpath.classed('leaflet-hidden', !enabled);\n\t\tlegend.select('text').style('text-decoration-line', enabled ? '' : 'line-through');\n\t\tlegend.select('rect').style('fill-opacity', enabled ? '': '0');\n\t\t// Apply d3-zoom (bind <clipPath> mask)\n\t\tif (this._mask) {\n\t\t\tpath.attr('mask', 'url(#' + this._mask.attr('id') + ')');\n\t\t}\n\t\tif (!lazy) {\n\t\t\tthis._updateArea();\n\t\t}\n\t},\n\n\t_hideDiagramIndicator() {\n\t\tthis._tooltip.attr(\"display\", 'none');\n\t},\n\n\t/**\n\t * Calculate chart xTicks\n\t */\n\t_xTicks() {\n\tif (this.__xTicks) this.__xTicks = this.options.xTicks;\n\treturn this.__xTicks || Math.round(this._width() / 75);\n},\n\n\t/**\n\t * Calculate chart yTicks\n\t */\n\t_yTicks() {\n\t\tif (this.__yTicks) this.__yTicks = this.options.yTicks;\n\t\treturn this.__yTicks || Math.round(this._height() / 30);\n\t}\n});\n"],"names":["Area","width","height","xAttr","yAttr","scaleX","scaleY","interpolation","d3","area","curve","x","d","xDiagCoord","y0","y1","Path","name","color","strokeColor","strokeOpacity","fillOpacity","className","path","create","classed","style","attr","Axis","type","tickSize","tickPadding","position","axis","scale","ticks","tickFormat","label","labelX","labelY","onAxisMount","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","append","join","call","text","Grid","props","PositionMarker","theme","xCoord","yCoord","labels","item","length","line","select","circle","node","isNaN","Object","keys","sort","a","b","order","forEach","i","size","value","selectAll","LegendItem","margins","toLowerCase","on","ownerSVGElement","dispatch","detail","legend","enabled","bottom","L","_","LegendSmall","items","onClick","idx","data","y","e","setIdx","Util","wrapNum","symbol","symbolTriangle","angle","id","exit","remove","enter","merge","slice","Tooltip","box","rect","xAlign","yAlign","bbox","getBBox","Math","max","Browser","webkit","Ruler","CheckPoint","point","property","datum","pos","y2","x2","Domain","min","forceBounds","domain","extent","Range","Scale","range","scaleLinear","Bisect","bisector","left","invert","Chart","ruler","right","top","svg","defs","panes","grid","brush","tooltip","mask","random","toString","substr","maskRect","foreignObject","canvas","context","getContext","brushX","utils","chart","opts","test","navigator","platform","userAgent","_width","_height","_resize","Control","Elevation","Utils","Class","extend","includes","Evented","prototype","Mixin","Events","initialize","control","this","options","_data","_props","scales","paths","areas","grids","axes","legendItems","tooltipItems","_scales","_domains","_ranges","_paths","_brushEnabled","dragging","_zoomEnabled","zooming","xTicks","_xTicks","yTicks","_yTicks","_chart","_container","_grid","pane","_area","_point","_axis","_legend","_tooltip","_ruler","_initScale","_mask","get","_context","_brush","_zoom","zoom","_drag","drag","_initInteractions","_maskGaps","index","push","once","update","_updateScale","_updateAxis","_updateMargins","_updateLegend","_updateClipper","_updateArea","render","container","clear","_resetDrag","_hideDiagramIndicator","clearRect","_drawPath","preferCanvas","drawCanvas","_hasActiveLayers","_initBrush","focus","pointers","_findIndexForXCoord","fire","filter","shiftKey","button","selection","start","end","dragstart","dragend","bind","_initClipper","margin","scaleExtent","translateExtent","Infinity","buttons","transform","sourceEvent","k","distance","_x","rescaleX","time","_initRuler","_initLegend","toggleStyle","toggleClass","formatNum","format","yMax","clamp","_y","imperial","coords","_findCoordsForY","_registerAxisScale","xAxisMin","xAxisMax","yAxisMin","yAxisMax","altitude","_registerAreaPath","_registerAxisGrid","forceAxisBounds","yScale","xScale","_registerCheckPoint","latlng","_findIndexForLatLng","_registerTooltip","each","gridOpts","axesOpts","n","translate","substring","indexOf","split","x1","xAxesB","nodes","v","Array","floor","fill","map","sign","rev","reverse","concat","selected","_togglePath","xAxesL","xAxesR","marginB","marginL","marginR","marginsUpdated","z","list","reduce","array","next","curr","result","dist","distanceTo","_resetZoom","zoomIdentity","_showDiagramIndicator","xCoordinate","lazy","__xTicks","round","__yTicks"],"sourceRoot":""}
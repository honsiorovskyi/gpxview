"use strict";(self.webpackChunkgpx_viewer=self.webpackChunkgpx_viewer||[]).push([[368],{368:(t,i,e)=>{e.r(i),L.Control.Ruler=L.Control.extend({options:{position:"topright",circleMarker:{color:"red",radius:2},lineStyle:{color:"red",dashArray:"1,6"},lengthUnit:{display:"km",decimal:2,factor:.001,label:"Distance:"},angleUnit:{display:"&deg;",decimal:2,factor:360,label:"Bearing:"}},initialize:function(t){L.setOptions(this,t),this._layers=L.layerGroup(),this._enabled=!1},onAdd:function(t){this._defaultCursor=t._container.style.cursor,this._map=t;let i=L.DomUtil.create("div","leaflet-bar");return i.classList.add("leaflet-ruler"),L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"click",this._toggleMeasure,this),this._container=i},onRemove:function(){L.DomEvent.off(this._container,"click",this._toggleMeasure,this)},_attachMouseEvents:function(){let t=this._map;t.doubleClickZoom.disable(),L.DomEvent.on(t._container,"keydown",this._escape,this),L.DomEvent.on(t._container,"dblclick",this._closePath,this),t._container.style.cursor="crosshair",t.on("click",this._addPoint,this),t.on("mousemove",this._moving,this)},_removeMouseEvents:function(){let t=this._map;t.doubleClickZoom.enable(),L.DomEvent.off(t._container,"keydown",this._escape,this),L.DomEvent.off(t._container,"dblclick",this._closePath,this),t._container.style.cursor=this._defaultCursor,t.off("click",this._addPoint,this),t.off("mousemove",this._moving,this)},_disable:function(){this._enabled=!1,this._container.classList.remove("leaflet-ruler-clicked"),this._map.removeLayer(this._layers),this._layers=L.layerGroup(),this._latlngs=[],this._totalLength=0,this._removeMouseEvents()},_enable:function(){this._enabled=!0,this._container.classList.add("leaflet-ruler-clicked"),this._circles=L.featureGroup().addTo(this._layers),this._polyline=L.polyline([],this.options.lineStyle).addTo(this._layers),this._layers.addTo(this._map),this._latlngs=[],this._totalLength=0,this._attachMouseEvents()},_toggleMeasure:function(){this._enabled?this._disable():this._enable()},_drawTooltip:function(t,i,e){let s,n,l=this._latlngs.length,o=l?this._latlngs[l-1]:t,a=this._calculateBearing(o,t),h=o.distanceTo(t)*this.options.lengthUnit.factor;e?(s=(l?h+this._totalLength||0:h).toFixed(this.options.lengthUnit.decimal),n=l?'<br><div class="plus-length">(+'+h.toFixed(this.options.lengthUnit.decimal)+")</div>":""):(this._totalLength+=h,s=(l?this._totalLength:h).toFixed(this.options.lengthUnit.decimal),n="");var r="<b>"+this.options.angleUnit.label+"</b>&nbsp;"+a.toFixed(this.options.angleUnit.decimal)+"&nbsp;"+this.options.angleUnit.display+"<br><b>"+this.options.lengthUnit.label+"</b>&nbsp;"+s+"&nbsp;"+this.options.lengthUnit.display+n;i.setLatLng(t);let c=i.getTooltip();return c?c.setTooltipContent(r):i.bindTooltip(r,e?{direction:"auto",sticky:!0,offset:L.point(0,-40),className:"moving-tooltip"}:{permanent:!0,className:"result-tooltip"}).openTooltip(),i},_addPoint:function(t){let i=t.latlng||t,e=L.circleMarker(i,this.options.circleMarker).addTo(this._circles);this._polyline.addLatLng(i),this._latlngs.length&&!i.equals(this._latlngs[this._latlngs.length-1])&&this._drawTooltip(i,e,!1),this._latlngs.push(i)},_moving:function(t){if(this._latlngs.length){let i=this._latlngs[this._latlngs.length-1];this._tempLine||(this._tempLine=L.polyline([],this.options.lineStyle).addTo(this._map)),this._tempPoint||(this._tempPoint=L.circleMarker(t.latlng,this.options.circleMarker).addTo(this._map)),this._tempLine.setLatLngs([i,t.latlng]),this._drawTooltip(t.latlng,this._tempPoint,!0),L.DomEvent.off(this._container,"click",this._toggleMeasure,this)}},_escape:function(t){27===t.keyCode&&(this._latlngs.length?this._closePath():(this._enabled=!0,this._toggleMeasure()))},_calculateBearing:function(t,i){const e=L.DomUtil.DEG_TO_RAD,s=this.options.angleUnit.factor/2/Math.PI;let n=Math.sin((i.lng-t.lng)*e)*Math.cos(i.lat*e),l=Math.cos(t.lat*e)*Math.sin(i.lat*e)-Math.sin(t.lat*e)*Math.cos(i.lat*e)*Math.cos((i.lng-t.lng)*e);return(Math.atan2(n,l)*s+this.options.angleUnit.factor)%this.options.angleUnit.factor},_closePath:function(){this._tempLine&&(this._map.removeLayer(this._tempLine),this._tempLine=null),this._tempPoint&&(this._map.removeLayer(this._tempPoint),this._tempLine=null),this._latlngs.length<=1&&this._map.removeLayer(this._circles),this._enabled=!1,L.DomEvent.on(this._container,"click",this._toggleMeasure,this),this._toggleMeasure()}}),L.control.ruler=function(t){return new L.Control.Ruler(t)}}}]);
//# sourceMappingURL=368.bundle.js.map